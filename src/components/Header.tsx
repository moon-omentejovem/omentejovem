'use client'

import { headerAnimations } from '@/animations/client'
import { cn } from '@/lib/utils'
import Image from 'next/image'
import Link from 'next/link'
import { usePathname, useSelectedLayoutSegment } from 'next/navigation'
import { useEffect, useState } from 'react'
import { logo, logoOrange } from '@/assets/images'
import { Icons } from './Icons'

const tabs = [
  {
    name: 'portfolio',
    link: '/portfolio'
  },
  {
    name: '1/1',
    link: '/1-1'
  },
  {
    name: 'editions',
    link: '/editions'
  },
  {
    name: 'series',
    link: '/series'
  },
  {
    name: 'artifacts',
    link: '/artifacts'
  }
]

export function Header() {
  const segment = useSelectedLayoutSegment()
  const [mounted, setMounted] = useState(false)
  const activeSegment = mounted ? segment : null
  const pathname = usePathname()
  const isHomepage = pathname === '/' || pathname === '/home'
  const isArtifactsRoute = pathname?.startsWith('/artifacts') ?? false

  const [showMobileMenu, setShowMobileMenu] = useState<boolean>(false)
  const [headerLogoVariant, setHeaderLogoVariant] = useState<
    'black' | 'orange'
  >('black')

  useEffect(() => {
    setMounted(true)
  }, [])

  useEffect(() => {
    headerAnimations()
  }, [])

  useEffect(() => {
    if (!isHomepage && !isArtifactsRoute) return

    const updateFromCssVariable = () => {
      const raw = getComputedStyle(document.documentElement).getPropertyValue(
        '--header-logo-color'
      )
      const normalized = raw.trim().toLowerCase()
      setHeaderLogoVariant(normalized === '#f7ea4d' ? 'orange' : 'black')
    }

    updateFromCssVariable()
    const timeout = window.setTimeout(updateFromCssVariable, 0)

    const observer = new MutationObserver(() => {
      updateFromCssVariable()
    })
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['style']
    })

    return () => {
      window.clearTimeout(timeout)
      observer.disconnect()
    }
  }, [isHomepage, isArtifactsRoute])

  return (
    <header className="sticky top-0 flex w-full justify-between bg-transparent z-30 md:bg-transparent p-8 md:px-12 lg:px-20 md:py-10 md:gap-16">
      <Link
        href="/"
        className="header-tab min-w-fit overflow-hidden"
        onClick={() => {
          document.cookie = 'newsletter_dismissed=true; path=/; max-age=3600'
        }}
      >
        {isHomepage || isArtifactsRoute ? (
          <Image
            src={headerLogoVariant === 'orange' ? logoOrange : logo}
            alt="omentejovem logo"
            className="h-[23px] w-auto"
            priority
          />
        ) : (
          <div
            className={cn(
              'opacity-20 hover:opacity-100',
              !activeSegment && 'opacity-100'
            )}
            style={{ color: 'var(--header-logo-color)' }}
          >
            <Image
              src={logo}
              alt="omentejovem logo"
              className="h-[23px] w-auto"
              priority
            />
            <svg
              id="Layer_2"
              data-name="Layer 2"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 2852.01 1682.31"
              aria-label="Omentejovem Logo"
              className="hidden h-[23px] w-auto"
              fill="currentColor"
            >
              <defs>
                <style>{'.cls-1{fill:#f7ea4d;}'}</style>
              </defs>
              <g id="Layer_1-2" data-name="Layer 1">
                <g>
                    <path d="M1531.7,724.65c-55.29,2.03-104.76-32.68-157.88-45.07-41.27,3.23-77.97-13.8-117.5-20.05-44.97-7.99-90.12-5.39-134.43-18.11-93.22-27.18-199.48-.93-284.62-55.2-30.51-15.63-56.93-41.13-74.16-70.59-7.45-19.23,8.04-38.59,6.48-58.76-6.33-32.23,16.21-48.43,40.26-65.18,30.32-13.2,58.4-31.91,90.24-40,48.84-21.91,107.4-13.4,154.28-41.23,90.75-22.87,184.9-8.93,277.12-7.7,79.37-3.84,159.69-9.13,237.4,11.55,55.15,19.54,116.32,8.04,171.66,27.63,44.88,9.36,84.12,40.07,131.01,39.93,32.7,6.11,61.08,26.51,95.3,27.95,17,3.78,26.58,20.4,44.36,24.36,23.76,8.69,54.96,9.29,72.15,29.59,20.78,24.63,54.02,33.27,85.55,40.3,17.22,7.88,31.8,19.75,48.6,28.76,30.25,25.9,56.31,56.13,93.63,69.32,14.83,19.2,43.5,21.17,57.68,38.38,6.37,18.34,25.89,27.57,31.29,46.51,5.34,14.22,14.23,25.52,27.89,32.76,32.53,21.75,44.08,58.62,59.83,92.73,2.51,12.4,23.62,8.67,19.45,23.97-7.15,23.09,27.67,27.61,22.74,46.63-1.27,4.86-.26,8.85,2.91,12.22,17.26,22.33,2.98,53.97,15.51,79.26,9.02,20.38-1.54,42.43,6.3,62.8,7.42,29.68-1.4,62.96-4.14,91.68-19.72,33.82-12.57,76.42-37.2,107.27-26,17.74-54.11,39.49-63.56,71.31-1.31,11.27-8.96,17.48-16.33,25.14-25.44,16.94-41.76,44.07-73.13,51.02-9.78,4.88-10.36,19.64-23.47,20.32-9.76,1.82-15.81,12.7-26.39,11.64-17.64-.33-20.16,21.38-33.03,25.52-22.6-.06-4.36,27.83-28,25.9-9.34.06-10.42,1.42-12.84,10.59-11.98,20.25-53.33,3.47-68.41,23.96-2.55,3.88-5.48,6.71-10.73,6.28-23.47,13.35-53.93,5.43-74.68,23.81-32.35,28.45-77.97,30.36-119.43,36.75-24.26,13.73-55.96,14.47-77.22,31.17-3.01,4.38-7.1,6.19-12.75,4.66-15.59-8.91-20.43,19.22-32.7,8.16-15.57-15.41-10.41,18-41.93,14.95-112.49,7.62-221.29,31.64-333.03,40.54-39.6,9.55-80.35.41-119.02,5.65-13.35,8.22-25.84-6.05-40.23-3.01-19.47,2.31-41-.57-58.31,9.56-3.91,2.82-8.23,2.45-12.53.27-15.48-9.16-33.33-3.17-50.3-2.77-29.33-8.96-59.75-3.65-89.48-10.08-55.15,1.07-106.82-17.88-162.72-16.64-37.05-5.68-72.07-19.56-109.18-25.55-28.54-4.45-56.77-3.11-84.74-13.25-63.23-12.52-127.21-8.23-190.52-23.92-26.97-13.47-57.85-10.03-85.64-17.83-14.79-4.09-28.2-11.62-42.23-17.52-46.44-29.4-95.58-53.56-145.07-77.03-20.64-9.47-40.92-20.44-60.41-32.43-19.54-13.79-37.61-30.27-59.22-39.25-39.65-16.63-71.09-48.31-104.37-75-16.27-10.86-32.68-21.9-50.26-30.02-17.6-8.96-32.11-23.69-49.63-33.12-23.37-14.63-44.68-32.38-67.18-47.99-21.46-19.19-42.44-38.86-64.03-57.93-21.33-26.46-46.4-49.77-69.35-74.84-6.15-13.18-16.98-23.2-26.4-33.94-14.18-15.62-28.54-31.59-35.44-51.94-4.81-10.88-11.71-20.31-19.9-28.89-5.28-4.83-7.12-11.51-9.46-17.91-16.52-31.14-29.31-64.48-39.87-98.48-46.69-157.53-24.3-321.46,44.69-465.32,55.33-116.54,143.44-218.22,252.91-288.79,69.86-45.17,145.95-78.98,226.31-101.24,15.85-4.14,32.58-5.27,47.49-11.97,27.42-10.97,57.06-13.45,86.13-17.41,38.38,2.74,76.65-3.67,114.99-1.33,22.9,1.68,46.01-2.57,68.67,2.22,21.61-.07,43-.71,63.89,4.91,34.62,7.96,70.06,10.5,104.83,17.13,59.8,9.58,118.85,25.26,176.13,45.2,39.99,16.16,81.14,29.78,119.67,49.14,33.7,16.52,68.04,31.69,99.03,52.78,23.3,18.66,48.75,35.09,70.33,55.87,18.11,12.8,34.12,28.49,51.38,42.41,19.23,21.98,37.74,44.83,56.99,66.81,33.88,38.64,57.5,85.2,86.65,127.93,24.23,45.51,50.2,90.08,72.03,137.05,6.17,10.14,11.04,21.08,19.02,30.02,16.97,29.97,32.33,61.62,43.82,94.11,3.12,8.92,5.02,18.24,8.81,26.96,4.24,19.79,10.03,38.96,15.1,58.44,7.12,21.87,7.58,45.41,15.01,67.41,4.47,22.71,8.29,45.7,12.93,68.39,1.81,12.63,3.11,25.39,5.52,37.78-3.79,12.89-4.6,26.52-7.83,39.54-1.6,8.78-1.14,17.43-1.24,26.27-2.27,26.23-7.08,52.02-10.11,78.13-3.08,14.95-9.94,28.74-12.48,43.86-5.6,17.44-15.71,32.78-21.2,50.3-.57,2.23-1.45,4.34-2.65,6.31-6.72,7.83-8.54,18.42-13.46,27.47-9.89,21.33-22.59,41.08-34.11,61.61-12.75,18.51-26.73,35.9-40.43,53.55-43.32,63.81-98.53,118.67-161.14,163.88-27.28,20.11-55.74,38.71-85.31,55.41-12.96,7.45-25.08,16.3-38.35,23.52-18.42,8.02-34.62,20.55-53.63,27.74-17.92,5.31-33.25,15.95-51.11,21.48-22.11,7.4-43.3,17.09-65.08,25.1l-96.55,27.3c-17.8,3.95-35.16,9.68-52.95,13.64-20.2,2.81-40.3,6.65-60.38,10.43-26.99,5.78-54.87,4.4-81.93,10.73-23.82.58-47.23,4.23-70.97,4.81-28.2-3.71-56.59-1.65-84.98-1.95-30.8.89-61.07-4.3-91.74-5.09-35.21-3.95-69.7-10.88-104.9-14.85-19.48-4.05-38.76-9.06-58.13-13.5-23.53-4.19-45.59-12.74-68.2-19.05-13.42-3.07-26.23-7.96-39.03-12.88-15.34-4.91-30.47-10.63-45.6-16.06-27.26-8.87-53.32-20.59-80.03-30.74-19.45-8.3-38.21-18.19-57.49-26.8-26.92-10.6-51.61-25.5-76.88-39.21-22.28-16.37-45.38-31.84-67.91-47.97-30.82-23.17-64.1-43.44-92.04-70.7-12.37-10.23-24.57-20.64-36.81-31.01-17.03-15.95-33.48-32.97-48.5-50.98-18.91-20.97-37.62-42.2-55.6-64.04-18.23-26.62-35.8-53.84-53.08-81.29-18.82-30.24-32.75-62.91-47.39-95.19-17.66-36.33-29.9-75.2-42.09-113.62-5.63-17.76-9.55-36.12-13.73-54.34-7.35-24.22-10.55-49.41-14.95-74.33-1.44-9.76-2.77-19.48-2.89-29.37-3.44-32.31-3.18-64.91-2.75-97.4,1.26-16.46,1.67-33,3.72-49.39,3.19-25.87,6.99-51.74,11.64-77.35,1.94-10.7,4.6-21.22,7.62-31.67,7.8-25.03,14.86-50.33,25.1-74.57,8.95-23.83,18.16-47.56,28.49-70.82,11.15-22.65,23.69-44.45,36.88-65.9,21.11-36.08,44.63-70.82,69.15-104.55,19.55-24.62,40.9-47.83,62.38-70.81,26.82-24.81,54.68-48.46,83.77-70.61,23.19-17.17,47.25-33.25,71.57-48.91,22.12-12.7,43.19-27.38,66.47-38.24,19.28-9.24,38-19.89,57.79-28.19,19.4-7.08,38.26-15.77,58.2-21.53,14.24-2.3,27.32-8.56,41.36-11.75,16.36-2.9,31.96-9.11,48.44-11.59,17.21-2.06,34.01-6.96,51.25-8.76,13.83-.88,27.31-4.39,41.16-5.13,16.43-.37,32.49-3.27,48.93-3.81,21.37,2.36,42.97,2.45,64.52,3.36,39.04,4.02,77.93,9.32,116.79,14.71,13.42,3.58,26.98,6.77,40.68,9.25,24.77,4.97,48.51,13.61,72.94,19.96,15.43,5.25,31.14,9.76,46.54,15.18l89.81,34.06c30.08,13.21,58.71,29.39,88.01,44.14,21.44,10.6,40.38,25.21,60.37,38.2,18.1,14.93,38.16,27.42,55.35,43.46,20.02,16.99,39.39,34.78,57.66,53.76,16.51,20.74,34.12,40.39,51.43,60.36,13.09,16.44,22.87,35.25,35.66,51.87,9.36,13.84,18.15,28.14,27.16,42.27,13.26,18.22,22.37,38.89,33.26,58.55,21.52,41.36,37.05,85.47,53.04,129.26,22.74,64.33,33.99,133.65,38.26,202.42,2.43,13.96-2.22,27.56-2.67,41.4-3.32,31.06-6.44,62.03-11.64,92.78-1.25,8.14-2.6,16.27-6.68,23.67-.36.52-.72,1.02-1.14,1.47-7.64,9.87-7.44,24.28-16.1,33.91-2.16,3.58-3.33,7.71-3.72,11.91-8.72,15.69-15.86,32.47-27.06,46.88-7.12,11.21-15.68,21.61-24.82,31.42-10.73,10.36-20.21,22.01-31.34,32.15-20.54,20.08-44.35,35.67-66.19,53.74-9.52,7.1-20.49,11.98-30.6,18.06-28.45,18.71-60.92,29.55-92.53,41.07-15.88,4.92-31.57,10.63-47.59,14.97-25.95,5.45-51.05,14.14-77.5,18.2-20.46,2.83-40.49,8.09-61.16,9.94-19.98,2.88-39.94,5.22-59.82,7.5l-45.45,2.44Z" />
                    <path d="M2847.66,291.18c-18,31.51-31.07,70.86-54.63,99.09-7.61,8.94-17.94,14.94-27.01,22.22-8.07,6.89-17.42,13.8-26.97,16.85-9.56,3.24-19.01,7.64-27.82,13.3-11.26,7.16-24.58,10.91-37.94,10.93-10.02.16-18.53-1.47-27.37-.15-10.08,1.43-17.85,6.88-28.06,8.97-11.17,2.51-24.54,2.23-35.12-.71-7.05-1.98-13.57-6.07-20.11-8.44-4.43-1.64-9.12-2.58-13.79-3.1-12.09-.94-25.39-2.47-37.57-5.92-7.94-2.04-16.09-4.68-22.14-8.97-4.6-3.16-8.43-7.01-12.5-10.87-6.26-6.22-13.88-11.39-21.27-16.34-12.41-8.45-23.73-18.4-31.84-30.89-3.7-5.6-7.44-11.2-13.02-14.9-11.1-6.97-20.15-10.46-21.29-24.48-.83-6.9-.49-14.69-3.28-21.05-3.44-8.37-11.85-12.82-16.94-19.92-7.08-9.29-.79-21.51-.76-33.1.57-10.3-.51-20.74-.47-30.95.12-12.7,1.74-24.86.67-37.57-4.76-40.18,6.89-40.59,24.35-72.45,9.83-17.31,17.97-37.38,34.71-49.06,7.84-5.5,16.62-9.76,24.76-14.9,13.27-8.3,25.18-18.54,39.31-25.2,7.26-3.59,15.61-5.8,22.81-9.26,7.83-3.98,16.1-6.9,24.58-9.42,5.48-2.08,11.16-3.89,16.6-6.77,6.69-3.56,12.65-7.85,20.63-8.08,13.03-.31,25.44,5.78,37.98,9.2,20.47,6.4,44.43,7.24,63.96,9.82,23.89,2.38,42.68,15.47,61.82,29.13,7.79,5.39,15.53,10.6,23.8,14.97,11.14,5.87,22.09,8.82,28.35,19.37,4.06,6.53,5.35,14.56,9.36,21.13,5.85,8.92,16.84,13.75,21.04,23.97,3.9,8.15,4.27,18.07,7.4,27.39,3.73,11.28,9.78,21.29,12.32,32.89,5.25,24.04,8.87,56.47,9.78,80.7.27,8.44-1.25,16.47-4.26,22.48l-.06.13Z" />
                    <path className="cls-1" d="M2641.19,240.06c-2.44,4.27-4.21,9.6-7.4,13.43-1.03,1.21-2.43,2.02-3.66,3.01-1.09.93-2.36,1.87-3.66,2.28-1.3.44-2.58,1.04-3.77,1.8-1.53.97-3.33,1.48-5.14,1.48-1.36.02-2.51-.2-3.71-.02-1.37.19-2.42.93-3.8,1.22-1.51.34-3.33.3-4.76-.1-.96-.27-1.84-.82-2.73-1.14-.6-.22-1.24-.35-1.87-.42-1.64-.13-3.44-.33-5.09-.8-1.08-.28-2.18-.63-3-1.22-.62-.43-1.14-.95-1.69-1.47-.85-.84-1.88-1.54-2.88-2.21-1.68-1.15-3.22-2.49-4.32-4.19-.5-.76-1.01-1.52-1.76-2.02-1.5-.94-2.73-1.42-2.89-3.32-.11-.94-.07-1.99-.44-2.85-.47-1.13-1.61-1.74-2.3-2.7-.96-1.26-.11-2.92-.1-4.49.08-1.4-.07-2.81-.06-4.2.02-1.72.24-3.37.09-5.09-.64-5.45.93-5.5,3.3-9.82,1.33-2.35,2.44-5.07,4.7-6.65,1.06-.75,2.25-1.32,3.36-2.02,1.8-1.12,3.41-2.51,5.33-3.42.98-.49,2.12-.79,3.09-1.26,1.06-.54,2.18-.93,3.33-1.28.74-.28,1.51-.53,2.25-.92.91-.48,1.71-1.06,2.8-1.09,1.77-.04,3.45.78,5.15,1.25,2.77.87,6.02.98,8.67,1.33,3.24.32,5.78,2.1,8.38,3.95,1.06.73,2.1,1.44,3.23,2.03,1.51.8,2.99,1.19,3.84,2.62.55.89.72,1.97,1.27,2.86.79,1.21,2.28,1.86,2.85,3.25.53,1.1.58,2.45,1,3.71.51,1.53,1.33,2.89,1.67,4.46.71,3.26,1.2,7.65,1.33,10.94.04,1.14-.17,2.23-.58,3.05v.02Z" />
                  </g>
                </g>
            </svg>
          </div>
        )}
      </Link>

      <div
        id="header-tabs"
        className="flex-row justify-between w-full max-w-[640px] md:flex"
      >
        {tabs.map((tab, index) => (
          <Link
            key={index}
            href={tab.link}
            className="header-tab min-w-fit overflow-hidden"
          >
            <p
              className={cn(
                'font-heading text-secondary-100 hover:text-secondary-200 hover:underline',
                tab.link.startsWith(`/${activeSegment}`) &&
                  'text-secondary-200 underline'
              )}
            >
              {tab.name}
            </p>
          </Link>
        ))}
      </div>

      <Link
        href="/about"
        className="header-tab min-w-fit overflow-hidden md:flex"
        id="about-link"
      >
        <p
          className={cn(
            'font-heading  text-secondary-100 hover:text-secondary-200 hover:underline',
            activeSegment === 'about' && 'text-secondary-200 underline'
          )}
        >
          about
        </p>
      </Link>

      <button
        aria-label="Filter Menu"
        className="group grid relative place-items-center w-6 md:hidden"
        onClick={() => setShowMobileMenu(!showMobileMenu)}
      >
        <Icons.X
          className={cn(
            showMobileMenu ? 'scale-100' : 'scale-0',
            'absolute stroke-secondary-100 transition-all group-hover:opacity-60 w-8 h-8'
          )}
        />
        <Icons.Menu
          className={cn(
            showMobileMenu ? 'scale-0' : 'scale-100',
            'absolute stroke-secondary-100 transition-all group-hover:opacity-60 w-8 h-8'
          )}
        />
      </button>

      {showMobileMenu && (
        <button
          className="fixed inset-0 top-[4.5rem] z-10 bg-black/[40%] max-w-[100vw]"
          onClick={() => setShowMobileMenu(false)}
        >
          <div
            className="h-fit z-20 flex w-full flex-col px-6 py-6 gap-2 bg-transparent absolute"
            style={{ top: 0 }}
          >
            {tabs.map((tab, index) => (
              <Link
                key={index}
                href={tab.link}
                className="header-tab flex justify-end"
              >
                <p
                  className={cn(
                    'font-heading text-secondary-100',
                    tab.link.startsWith(`/${activeSegment}`) &&
                      'text-secondary-200 underline'
                  )}
                >
                  {tab.name}
                </p>
              </Link>
            ))}
            <Link href="/about" className="header-tab flex justify-end">
              <p
                className={cn(
                  ' font-heading text-secondary-100',
                  activeSegment === 'about' && 'text-secondary-200 underline'
                )}
              >
                about
              </p>
            </Link>
          </div>
        </button>
      )}
    </header>
  )
}
